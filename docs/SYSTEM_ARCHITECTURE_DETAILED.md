# ğŸ—ï¸ SCARLET SAILS - ARCHITECTURE

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ğ½Ñ‹Ñ… Ñ€Ñ‹Ğ½ĞºĞ¾Ğ²**

**Version**: 1.0.0  
**Last Updated**: 23 Ğ½Ğ¾ÑĞ±Ñ€Ñ 2025  
**Status**: âœ… ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°

---

## ğŸ“‹ Ğ¡ĞĞ”Ğ•Ğ Ğ–ĞĞĞ˜Ğ•

1. [ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹](#ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹)
3. [ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾Ğº-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
4. [Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸](#ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸)
5. [ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ](#Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ)
6. [Ğ Ğ¸ÑĞº-Ğ¼ĞµĞ½ĞµĞ´Ğ¶Ğ¼ĞµĞ½Ñ‚](#Ñ€Ğ¸ÑĞº-Ğ¼ĞµĞ½ĞµĞ´Ğ¶Ğ¼ĞµĞ½Ñ‚)
7. [ĞœĞ¾Ğ´ĞµĞ»Ğ¸](#Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
8. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)

---

## ğŸ¯ ĞĞ‘Ğ—ĞĞ  Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«

Scarlet Sails - Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸, Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑÑÑ‰Ğ°Ñ:

- **Rule-Based**: RSI mean-reversion
- **Machine Learning**: XGBoost (AUC 0.70)
- **Reinforcement Learning**: DQN (Episode 87)
- **Hybrid**: Ğ’Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ°Ğ½ÑĞ°Ğ¼Ğ±Ğ»ÑŒ (Î±=0.45, Î²=0.45, Î³=0.10)

### Ğ¦ĞµĞ»ĞµĞ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ¦ĞµĞ»ÑŒ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|---------|------|--------|
| Monthly ROI | 10-25% | ğŸ”„ Phase 4 |
| Profit Factor | > 2.0 | âœ… 2.12 |
| Max Drawdown | < 15% | âœ… 9.44% |
| Sharpe Ratio | > 1.0 | ğŸ”„ Phase 4 |
| Win Rate | > 55% | ğŸ”„ Phase 4 |

---

## ğŸ§© ĞšĞ›Ğ®Ğ§Ğ•Ğ’Ğ«Ğ• ĞšĞĞœĞŸĞĞĞ•ĞĞ¢Ğ«

### 1. Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸

```
strategies/
â”œâ”€â”€ rule_based_v2.py      # RSI mean-reversion
â”œâ”€â”€ xgboost_ml_v2.py      # ML predictions (AUC 0.70)
â”œâ”€â”€ hybrid_v2.py          # Ensemble
â””â”€â”€ __init__.py
```

### 2. Reinforcement Learning

```
rl/
â”œâ”€â”€ dqn.py                   # DQN agent (12â†’[128,128]â†’3)
â”œâ”€â”€ trading_environment.py   # Trading environment
â””â”€â”€ __init__.py
```

### 3. ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

```
orchestrator.py              # Unified management
```

Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:
- Signal aggregation (voting)
- Portfolio management
- Risk validation
- Performance tracking

### 4. ĞĞ½Ğ°Ğ»Ğ¸Ğ·

```
analysis/
â”œâ”€â”€ dispersion_analyzer.py   # ANOVA, KS tests
â”œâ”€â”€ dispersion_visualizer.py # Charts
â””â”€â”€ __init__.py
```

---

## ğŸ”„ ĞŸĞĞ¢ĞĞš Ğ”ĞĞĞĞ«Ğ¥

```
Market Data (OHLCV)
        â†“
 [Feature Engineering]
        â†“
    [4 Strategies]
   /    |    |    \
  RB   ML  Hybrid  DQN
   \    |    |    /
        â†“
  [Orchestrator]
  (Voting/Aggregation)
        â†“
   [Risk Check]
    /        \
 PASS       FAIL
   â†“          â†“
[Execute]  [Hold]
   â†“
[Portfolio Update]
   â†“
[Metrics Logging]
```

---

## ğŸ² Ğ¡Ğ¢Ğ ĞĞ¢Ğ•Ğ“Ğ˜Ğ˜

### 1. Rule-Based (RSI)

**Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:**
```
P_rb = W_opportunity Ã— âˆ[filters] - C - R_adaptive
```

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹: 195/2000 (9.75%)
- Mean: 0.060
- Sparse, high-conviction

### 2. XGBoost ML

**Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:**
```
P_ml = f_ML(X) - C - R_ood
```

**ĞœĞ¾Ğ´ĞµĞ»ÑŒ:**
- Features: 31
- AUC: 0.6978
- Training: 10k samples (SMOTE)

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹: 2000/2000 (100%)
- Mean: 0.172
- Consistent

### 3. Hybrid

**Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°:**
```
P_hyb = Î±Â·P_rb + Î²Â·P_ml + Î³Â·V
```

**Ğ’ĞµÑĞ°:**
- Î± (Rule): 0.45
- Î² (ML): 0.45
- Î³ (RL): 0.10

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹: 1879/2000 (93.95%)
- Mean: 0.191
- Best balance

### 4. DQN RL

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:**
```
Input: 12 features
Hidden: [128, 128] (ReLU)
Output: 3 actions (Buy/Sell/Hold)
```

**Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (12 features):**
- Normalized price
- RSI, MACD, Bollinger
- Volume, Volatility
- Position status, PnL

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ñ‹: 2000/2000 (100%)
- Mean: 0.176
- Adaptive

---

## ğŸ›ï¸ ĞĞ ĞšĞ•Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯

### StrategyOrchestrator

```python
class StrategyOrchestrator:
    def __init__(strategies, capital, risk_config):
        # Initialize
        
    def aggregate_signals(signals):
        # Voting: majority wins
        
    def execute_signal(signal):
        # Risk check â†’ Execute
        
    def step(data, time):
        # Process one timestep
        
    def get_performance():
        # Return metrics
```

**Signal Aggregation:**
```
Buy votes > Sell votes â†’ BUY
Sell votes > Buy votes â†’ SELL
Otherwise â†’ HOLD
```

---

## ğŸ›¡ï¸ Ğ Ğ˜Ğ¡Ğš-ĞœĞ•ĞĞ•Ğ”Ğ–ĞœĞ•ĞĞ¢

### RiskManager

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```python
max_position_size = 0.10     # 10% equity
max_total_exposure = 0.50    # 50% equity
max_drawdown = 0.15          # 15% drawdown
```

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:**

1. **Position Size:**
   ```
   position_value / equity â‰¤ 10%
   ```

2. **Total Exposure:**
   ```
   Î£(positions) / equity â‰¤ 50%
   ```

3. **Drawdown:**
   ```
   (equity - peak) / peak â‰¥ -15%
   ```

---

## ğŸ“Š ĞœĞĞ”Ğ•Ğ›Ğ˜

### XGBoost V2

**Ğ¤Ğ°Ğ¹Ğ»:** `models/xgboost_trained_v2.json`  
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€:** 1.3 MB

**ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸:**
- AUC: 0.6978
- Precision: 0.64
- Recall: 0.66

**Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ:**
- +12% AUC vs V1
- 2x Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- SMOTE balancing

### DQN

**Ğ¤Ğ°Ğ¹Ğ»:** `models/dqn_best_pnl.pth`  
**Ğ Ğ°Ğ·Ğ¼ĞµÑ€:** 313 KB

**Config:**
```python
state_dim: 12
action_dim: 3
hidden: [128, 128]
gamma: 0.95
lr: 0.0001
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:**
- Episode: 87
- Steps: 173,913
- Epsilon: 0.65

---

## ğŸ“ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ Ğ¤ĞĞ™Ğ›ĞĞ’

```
scarlet-sails/
â”‚
â”œâ”€â”€ strategies/              # Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸
â”‚   â”œâ”€â”€ rule_based_v2.py
â”‚   â”œâ”€â”€ xgboost_ml_v2.py
â”‚   â””â”€â”€ hybrid_v2.py
â”‚
â”œâ”€â”€ rl/                      # RL ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”œâ”€â”€ dqn.py
â”‚   â””â”€â”€ trading_environment.py
â”‚
â”œâ”€â”€ analysis/                # ĞĞ½Ğ°Ğ»Ğ¸Ğ·
â”‚   â”œâ”€â”€ dispersion_analyzer.py
â”‚   â””â”€â”€ dispersion_visualizer.py
â”‚
â”œâ”€â”€ models/                  # ĞĞ±ÑƒÑ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”œâ”€â”€ xgboost_trained_v2.json (1.3 MB)
â”‚   â””â”€â”€ dqn_best_pnl.pth (313 KB)
â”‚
â”œâ”€â”€ orchestrator.py          # ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€
â”œâ”€â”€ backtester.py            # Backtesting
â”œâ”€â”€ test_integration.py      # Ğ¢ĞµÑÑ‚Ñ‹
â”œâ”€â”€ run_dispersion_analysis.py
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ ARCHITECTURE.md          # Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»
â”œâ”€â”€ requirements.txt
â””â”€â”€ .gitignore
```

---

## ğŸ“ˆ DISPERSION ANALYSIS

**Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:**
```
F-statistic: 611.86
p-value: < 0.001
etaÂ²: 19.64% (large effect)

Ğ’Ñ‹Ğ²Ğ¾Ğ´: Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚
ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ âœ…
```

**ĞšĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¸:**
```
         RB     ML    Hyb    DQN
RB     1.00  -0.02   0.02   0.01
ML    -0.02   1.00  -0.10  -0.13
Hyb    0.02  -0.10   1.00   0.04
DQN    0.01  -0.13   0.04   1.00
```

**Ğ’Ñ‹Ğ²Ğ¾Ğ´:** ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ° âœ…

---

## ğŸš€ DEPLOYMENT

### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

```bash
# 1. Clone
git clone https://github.com/USER/scarlet-sails.git
cd scarlet-sails

# 2. Install
pip install -r requirements.txt

# 3. Test
python test_integration.py
python run_dispersion_analysis.py

# 4. Backtest
python backtester.py
```

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

- Python 3.8+
- 8GB+ RAM
- GPU Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ (Ğ´Ğ»Ñ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ DQN)

---

## ğŸ”® ROADMAP

### Phase 4: "Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚ - 1" (45 Ğ´Ğ½ĞµĞ¹)

**Week 1-2:** Real Market Data
- Binance API integration
- Historical data pipeline
- Feature engineering

**Week 3-4:** Model Optimization
- Hyperparameter tuning
- Feature selection
- Cross-validation

**Week 5-6:** Ensemble Methods
- Model stacking
- Voting strategies
- Performance validation

**Week 7-8:** Risk Management
- Stop-loss optimization
- Position sizing
- Portfolio allocation

### ĞŸĞ¾ÑĞ»Ğµ Phase 4

- Live paper trading
- Multi-asset support
- Advanced RL (PPO, A3C)
- Real-time monitoring
- Production deployment

---

**Version**: 1.0.0  
**Author**: STAR_ANT + Team  
**Date**: 23 Ğ½Ğ¾ÑĞ±Ñ€Ñ 2025  
**Status**: âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Phase 4